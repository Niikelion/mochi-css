name: PR checks
on: [ pull_request ]
jobs:
    build:
        runs-on: ubuntu-latest
        permissions:
            contents: read
        steps:
            -   name: Enable Corepack
                run: corepack enable
            -   uses: actions/checkout@v4
            -   name: Use Node.js 24.x
                uses: actions/setup-node@v4
                with:
                    node-version: '24.x'
                    cache: 'yarn'
            -   name: Install dependencies
                run: yarn install --immutable
            -   name: Save node_modules
                uses: actions/cache/save@v4
                with:
                    path: node_modules
                    key: node-modules-${{ hashFiles('yarn.lock') }}
            -   name: Build packages
                run: yarn build
            -   name: Save build artifacts
                uses: actions/cache/save@v4
                with:
                    path: packages/*/dist
                    key: build-${{ github.sha }}
    lint:
        needs: build
        runs-on: ubuntu-latest
        permissions:
            contents: read
        steps:
            -   name: Enable Corepack
                run: corepack enable
            -   uses: actions/checkout@v4
            -   name: Restore build artifacts
                uses: actions/cache/restore@v4
                with:
                    path: packages/*/dist
                    key: build-${{ github.sha }}
            -   name: Restore node_modules
                uses: actions/cache/restore@v4
                with:
                    path: node_modules
                    key: node-modules-${{ hashFiles('yarn.lock') }}
            -   name: Use Node.js 24.x
                uses: actions/setup-node@v4
                with:
                    node-version: '24.x'
                    cache: 'yarn'
            -   name: Install dependencies
                run: yarn install --immutable
            -   name: Lint packages
                run: yarn lint
    test:
        needs: build
        runs-on: ubuntu-latest
        permissions:
            contents: read
        steps:
            -   name: Enable Corepack
                run: corepack enable
            -   uses: actions/checkout@v4
            -   name: Restore build artifacts
                uses: actions/cache/restore@v4
                with:
                    path: packages/*/dist
                    key: build-${{ github.sha }}
            -   name: Restore node_modules
                uses: actions/cache/restore@v4
                with:
                    path: node_modules
                    key: node-modules-${{ hashFiles('yarn.lock') }}
            -   name: Use Node.js 24.x
                uses: actions/setup-node@v4
                with:
                    node-version: '24.x'
                    cache: 'yarn'
            -   name: Install dependencies
                run: yarn install --immutable
            -   name: Run tests
                run: yarn test